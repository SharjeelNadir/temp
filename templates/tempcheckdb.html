<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Content</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            background-color: black;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            text-align: center;
            width: 90%;
            max-width: 1200px;
            margin: auto;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 18px;
            min-width: 400px;
        }
        table th, table td {
            padding: 12px 15px;
            border: 1px solid #dddddd6d;
            text-align: left;
        }
        table th {
            background-color: #f2f2f26f;
            color: black;
        }
        .arrow {
            color: rgba(0, 255, 229, 0.494);
            font-size: 24px;
            margin: 10px;
            cursor: pointer;
        }
        .arrow:hover {
            color: rgba(8, 255, 230, 0.725);
        }
        button {
            background-color: rgba(0, 255, 229, 0.494);
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: rgba(8, 255, 230, 0.725);
        }
    </style>
    <script>
        function makeEditable(tableId) {
            const table = document.getElementById(tableId);
            const rows = table.getElementsByTagName('tr');
            for (let i = 1; i < rows.length; i++) { // Skip header row
                const cells = rows[i].getElementsByTagName('td');
                for (let j = 0; j < cells.length; j++) {
                    cells[j].contentEditable = true;
                    cells[j].style.backgroundColor = '#525557'; // Highlight editable cells
                }
            }
            
            if (!document.getElementById('saveButton')) {
                const saveButton = document.createElement('button');
                saveButton.innerText = 'Save';
                saveButton.id = 'saveButton';
                saveButton.onclick = function() {
                    saveTableData(tableId);
                };
                table.parentNode.insertBefore(saveButton, table.nextSibling);
            }
        }

        function saveTableData(tableId) {
            const table = document.getElementById(tableId);
            const rows = table.getElementsByTagName('tr');
            const data = [];
            for (let i = 1; i < rows.length; i++) { // Skip header row
                const cells = rows[i].getElementsByTagName('td');
                const rowData = { 'id': rows[i].dataset.id }; // Use data-id attribute for row id
                for (let j = 0; j < cells.length; j++) {
                    rowData[table.rows[0].cells[j].innerText] = cells[j].innerText;
                }
                data.push(rowData);
            }

            const candidateId = parseInt(document.getElementById('candidate_id').value);
            const campaignNumber = parseInt(document.getElementById('campaign_number').value);

            fetch('/update-table', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ tableId: tableId, candidateId: candidateId, campaignNumber: campaignNumber, data: data })
            })
            .then(response => response.json())
            .then(data => {
                alert('Data saved successfully');
                location.reload(); // Reload the page after saving
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to save data');
            });
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>Candidate Details</h1>
        
        <!-- Candidate Personal Details -->
        <h2>Candidate Personal Details</h2>
        {% if candidate %}
        <table id="candidateTable">
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Address</th>
                <th>Campaign Number</th>
            </tr>
            <tr data-id="{{ candidate.id }}">
                <td contentEditable="false">{{ candidate.name }}</td>
                <td contentEditable="false">{{ candidate.email }}</td>
                <td contentEditable="false">{{ candidate.phone }}</td>
                <td contentEditable="false">{{ candidate.address }}</td>
                <td contentEditable="false">{{ candidate.campaign_number }}</td>
            </tr>
        </table>
        <button onclick="makeEditable('candidateTable')">Edit</button>
        {% endif %}
        
        <!-- Experiences -->
        <h2>Experiences</h2>
        <table id="experiencesTable">
            <tr>
                <th>Organization Name</th>
                <th>Designation</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Summary</th>
            </tr>
            {% for experience in experiences %}
            <tr data-id="{{ experience.id }}">
                <td contentEditable="false">{{ experience.organization_name }}</td>
                <td contentEditable="false">{{ experience.designation }}</td>
                <td contentEditable="false">{{ experience.start_date }}</td>
                <td contentEditable="false">{{ experience.end_date }}</td>
                <td contentEditable="false">{{ experience.summary }}</td>
            </tr>
            {% endfor %}
        </table>
        <button onclick="makeEditable('experiencesTable')">Edit</button>
        
        <!-- Skills -->
        <h2>Skills</h2>
        {% if skills %}
        <table id="skillsTable">
            <tr>
                <th>Skill</th>
            </tr>
            {% for skill in skills %}
            <tr data-id="{{ skill.id }}">
                <td contentEditable="false">{{ skill.skill }}</td>
            </tr>
            {% endfor %}
        </table>
        <button onclick="makeEditable('skillsTable')">Edit</button>
        {% endif %}
        
        <!-- Educations -->
        <h2>Educations</h2>
        {% if educations %}
        <table id="educationsTable">
            <tr>
                <th>Institute Name</th>
                <th>Degree</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Summary</th>
            </tr>
            {% for education in educations %}
            <tr data-id="{{ education.id }}">
                <td contentEditable="false">{{ education.institute_name }}</td>
                <td contentEditable="false">{{ education.degree }}</td>
                <td contentEditable="false">{{ education.start_date }}</td>
                <td contentEditable="false">{{ education.end_date }}</td>
                <td contentEditable="false">{{ education.summary }}</td>
            </tr>
            {% endfor %}
        </table>
        <button onclick="makeEditable('educationsTable')">Edit</button>
        {% endif %}
        
        <!-- Certifications -->
        <h2>Certifications</h2>
        {% if certifications %}
        <table id="certificationsTable">
            <tr>
                <th>Certification</th>
            </tr>
            {% for certification in certifications %}
            <tr data-id="{{ certification.id }}">
                <td contentEditable="false">{{ certification.certification }}</td>
            </tr>
            {% endfor %}
        </table>
        <button onclick="makeEditable('certificationsTable')">Edit</button>
        {% endif %}
        
        <!-- Research -->
        <h2>Research</h2>
        {% if research %}
        <table id="researchTable">
            <tr>
                <th>Research Title</th>
            </tr>
            {% for research_item in research %}
            <tr data-id="{{ research_item.id }}">
                <td contentEditable="false">{{ research_item.research_title }}</td>
            </tr>
            {% endfor %}
        </table>
        <button onclick="makeEditable('researchTable')">Edit</button>
        {% endif %}
        
        <!-- Resume Button -->
        {% if candidate.file_name %}
        <button onclick="window.open('/view-resume/{{ candidate.file_name }}', '_blank')">View Resume</button>
        {% endif %}
        
        <!-- Hidden Inputs for Candidate ID and Campaign Number -->
        <input type="hidden" id="candidate_id" value="{{ candidate.id }}">
        <input type="hidden" id="campaign_number" value="{{ campaign_number }}">
        
        <!-- Back to Candidate List Button -->
        <button onclick="window.location.href='/list-candidates'">Back to Candidate List</button>
    </div>
</body>
</html>
